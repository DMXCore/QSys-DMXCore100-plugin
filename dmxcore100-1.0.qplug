-- Plugin for DMX Core 100 Devices by DMX Pro Sales
-- Built in Lua

PluginInfo = {
    Name = "DMX Core~100 (1.0)", -- The tilde here indicates folder structure in the Schematic Elements pane
    Version = "1.0",
    Id = "dmx.core.100.1.0", -- show this is just a unique id. Show some commented out 'fun' unique ids
    Description = [[Plugin to control the DMX Core 100 lighting controller for sACN/ArtNet using presets and playback features]],
    ShowDebug = true,
    Author = "DMX Pro Sales"
}

function GetPrettyName()
    return string.format("DMX Core 100 v%s", PluginInfo.Version)
end

-- Once you've drawn your plugin in Designer, you can determine what colors you use a lot. Save yourself some time by putting them in a table, and then simply calling them later.
local Colors = {
    White = {255, 255, 255},
    Black = {0, 0, 0},
    Red = {255, 0, 0},
    Green = {0, 255, 0}
}

-- We can let users determine some of the plugin properties by exposing them here
-- While this function can be very useful, it is completely optional and not always needed.
-- If no Properties are set here, only the position and fill properties of your plugin will show in the Properties pane
function GetProperties()
    props = {}

    return props
end

-- The below function is optional (like GetProperties() is), but it can allow further customization of what users can and can't do with your plugin.
-- In this example, when Model 1 is selected in the properties pane, the ability to modify some of the properties will be hidden, only allowing customization with Model 2
-- Another application of this is if you have different input/output types for different models, and want those properties to be dynamic in the Properties pane
function RectifyProperties(props)
    return props
end

-- The below function is where you will populate the controls for your plugin.
-- If you've written some of the Runtime code already, simply use the control names you populated in Text Controller/Control Script, and use their Properties to inform the values here
-- ControlType can be Button, Knob, Indicator or Text
-- ButtonType ( ControlType == Button ) can be Momentary, Toggle or Trigger
-- IndicatorType ( ControlType == Indicator ) can be Led, Meter, Text or Status
-- ControlUnit ( ControlType == Knob ) can be Hz, Float, Integer, Pan, Percent, Position or Seconds
function GetControls(props)
    local ctls = {
        {
            Name = "ScriptActive",
            ControlType = "Indicator",
            IndicatorType = "Led",
            PinStyle = "Output",
            UserPin = true
        },
        {
            Name = "PresetActive",
            ControlType = "Indicator",
            IndicatorType = "Led",
            PinStyle = "Output",
            UserPin = true,
            Count = 6
        },
        {
            Name = "CueActive",
            ControlType = "Indicator",
            IndicatorType = "Led",
            PinStyle = "Output",
            UserPin = true,
            Count = 6
        },
        {
            Name = "Blink",
            ControlType = "Button",
            ButtonType = "Trigger",
            Count = 1,
            PinStyle = "Both",
            UserPin = true
        },
        {
            Name = "GoToPreset",
            ControlType = "Button",
            ButtonType = "Trigger",
            PinStyle = "Input",
            Count = 6,
            UserPin = true
        },
        {
            Name = "PlayCue",
            ControlType = "Button",
            ButtonType = "Trigger",
            PinStyle = "Input",
            Count = 6,
            UserPin = true
        },
        {
            Name = "FadeToBlack",
            ControlType = "Button",
            ButtonType = "Trigger",
            PinStyle = "Input",
            Count = 1,
            UserPin = true
        },
        {
            Name = "FadeTo100",
            ControlType = "Button",
            ButtonType = "Trigger",
            PinStyle = "Input",
            Count = 1,
            UserPin = true
        },
        {
            Name = "StopCue",
            ControlType = "Button",
            ButtonType = "Trigger",
            PinStyle = "Input",
            Count = 1,
            UserPin = true
        },
        {
            Name = "StatusDisplay",
            ControlType = "Indicator",
            IndicatorType = "Text",
            PinStyle = "Output",
            UserPin = true
        },
        {
            Name = "FadeDurationDisplay",
            ControlType = "Indicator",
            IndicatorType = "Text",
            PinStyle = "Output",
            UserPin = true
        },
        {
            Name = "LoopCountDisplay",
            ControlType = "Indicator",
            IndicatorType = "Text",
            PinStyle = "Output",
            UserPin = true
        },
        {
            Name = "PresetCode",
            ControlType = "Text",
            PinStyle = "Both",
            UserPin = true,
            Count = 6
        },
        {
            Name = "CueCode",
            ControlType = "Text",
            PinStyle = "Both",
            UserPin = true,
            Count = 6
        },
        {
            Name = "DMXCoreIP",
            ControlType = "Text",
            PinStyle = "Both",
            UserPin = true
        },
        {
            Name = "DMXCorePort",
            ControlType = "Knob",
            ControlUnit = "Integer",
            PinStyle = "Both",
            Count = 1,
            Min = 1,
            Max = 65535,
            UserPin = true
        },
        {
            Name = "MasterDimmer",
            ControlType = "Knob",
            ControlUnit = "Percent",
            PinStyle = "Both",
            Count = 1,
            UserPin = true
        },
        {
            Name = "FadeDuration",
            ControlType = "Knob",
            ControlUnit = "Seconds",
            PinStyle = "Output",
            Min = 0,
            Max = 5,
            Count = 1,
            UserPin = true
        },
        {
            Name = "LoopCount",
            ControlType = "Knob",
            ControlUnit = "Integer",
            PinStyle = "Both",
            Count = 1,
            Min = 0,
            Max = 100,
            UserPin = true
        }
    }
    return ctls
end

-- Variable holding Page Names for ease
local pagenames = {"Preset", "Cue", "Network"}

-- This function allows you to populate pages in your plugin.
function GetPages(props)
    local pages = {}
    for i in ipairs(pagenames) do
        table.insert(pages, {name = pagenames[i]})
    end
    return pages
end

-- This function allows you to layout pages in your plugin.
function GetControlLayout(props)
    local layout, graphics = {}, {}
    local currentPage = pagenames[props["page_index"].Value]
    local font = "Lato"
    local fontstyle = "Bold"
    local function Led(prettyname, legend, x, y, size_x, size_y)
        size_x = size_x or 30
        size_y = size_y or 30
        return {
            PrettyName = prettyname,
            Legend = legend,
            Size = {size_x, size_y},
            Position = {x, y},
            Style = "Led",
            Color = {0, 255, 0},
            OffColor = {102, 102, 102},
            UnlinkOffColor = true
        }
    end
    local function Button(prettyname, legend, x, y, size_x, size_y)
        size_x = size_x or 60
        size_y = size_y or 60
        return {
            PrettyName = prettyname,
            Legend = legend,
            Size = {size_x, size_y},
            Position = {x, y},
            Style = "Button",
            ButtonStyle = "Trigger",
            Font = font,
            FontSize = 12,
            FontStyle = fontstyle,
            Margin = 0,
            Radius = 8,
            Padding = 2,
            StrokeWidth = 2,
            StrokeColor = {0, 0, 0},
            OffColor = {102, 102, 102},
            UnlinkOffColor = true
        }
    end
    local function Fader(prettyname, legend, x, y)
        return {
            PrettyName = prettyname,
            Legend = legend,
            Style = "Fader",
            FontSize = 12,
            Font = font,
            FontStyle = fontstyle,
            Color = {102, 102, 102},
            Margin = 0,
            Radius = 8,
            Padding = 2,
            StrokeColor = {0, 0, 0},
            StrokeWidth = 2,
            Position = {x, y},
            Size = {60, 120},
            UnlinkOffColor = true,
            OffColor = {0, 0, 0}
        }
    end
    local function Box(prettyname, legend, pos_x, pos_y, size_x, size_y, fontsize, textalign)
        fontsize = fontsize or 14
        textalign = textalign or "Center"
        return {
            PrettyName = prettyname,
            Legend = legend,
            FontSize = fontsize,
            Font = font,
            FontStyle = fontstyle,
            Color = {51, 51, 51},
            Margin = 0,
            Radius = 8,
            Padding = 2,
            StrokeColor = {0, 0, 0},
            StrokeWidth = 2,
            Position = {pos_x, pos_y},
            Size = {size_x, size_y},
            UnlinkOffColor = true,
            OffColor = {102, 102, 102},
            HTextAlign = textalign
        }
    end
    local function Background(size_x, size_y)
        return {
            Type = "GroupBox",
            Fill = {26, 26, 26},
            StrokeColor = {138, 0, 133},
            StrokeWidth = 2,
            Color = {255, 0, 0},
            CornerRadius = 8,
            Position = {0, 0},
            Size = {size_x, size_y}
        }
    end
    local function Background2(pos_x, pos_y, size_x, size_y)
        return {
            Type = "GroupBox",
            Fill = {51, 51, 51},
            CornerRadius = 8,
            Position = {pos_x, pos_y},
            Size = {size_x, size_y}
        }
    end
    local function Text(text, fontsize, pos_x, pos_y, size_x, size_y, textalign)
        textalign = textalign or "Center"
        return {
            Text = text,
            Type = "Label",
            FontSize = fontsize,
            Font = font,
            FontStyle = fontstyle,
            Color = {255, 255, 255},
            HTextAlign = textalign,
            VTextAlign = "Center",
            Radius = 8,
            Position = {pos_x, pos_y},
            Size = {size_x, size_y}
        }
    end
    if currentPage == "Playbacks" then
        table.insert(graphics, Background(490, 700))
        table.insert(graphics, Background2(10, 90, 80, 600))
        layout["masterRelease"] = Button("Playback~Master~Release", "Release", 20, 100)
        layout["masterFade"] = Box("Playback~Master~Fade", "Fade", 20, 190, 60, 30)
        layout["masterFadeTrigger"] = Button("Playback~Master~Fade trigger", "Fade", 20, 220, 60, 30)
        layout["masterSolo"] = Box("Playback~Master~Solo", "Solo", 20, 280, 60, 30)
        layout["masterSoloTrigger"] = Button("Playback~Master~Solo", "Solo", 20, 310, 60, 30)
        layout["masterRate"] = Fader("Playback~Master~Rate", "Rate", 20, 400)
        layout["masterIntensity"] = Fader("Playback~Master~Intensity", "Intensity", 20, 520)
        table.insert(graphics, Text("Master", 20, 10, 650, 80, 30))
        table.insert(graphics, Background2(100, 90, 380, 600))
        for i = 1, 6 do
            --layout["playbackStatus "..i] = Led("Playback~"..i.."~Status", "Status+", 125+(60*(i-1)), 100)
            layout["goPlus " .. i] = Button("Playback~" .. i .. "~Go+", "Go+", 110 + (60 * (i - 1)), 100)
            layout["goMinus " .. i] = Button("Playback~" .. i .. "~Go-", "Go-", 110 + (60 * (i - 1)), 160)
            layout["release " .. i] = Button("Playback~" .. i .. "~Release", "Release", 110 + (60 * (i - 1)), 220)
            layout["solo " .. i] = Button("Playback~" .. i .. "~Solo", "Solo", 110 + (60 * (i - 1)), 280)
            layout["jump " .. i] = Box("Playback~" .. i .. "~Jump", "Jump", 110 + (60 * (i - 1)), 340, 60, 30)
            layout["jumpTrigger " .. i] =
                Box("Playback~" .. i .. "~Jump trigger", "Jump", 110 + (60 * (i - 1)), 370, 60, 30)
            layout["rate " .. i] = Fader("Playback~" .. i .. "~Rate", "Rate", 110 + (60 * (i - 1)), 400)
            layout["intensity " .. i] = Fader("Playback~" .. i .. "~Intensity", "Intensity", 110 + (60 * (i - 1)), 520)
            table.insert(graphics, Text(tostring(i), 24, 110 + (60 * (i - 1)), 650, 60, 30))
        end
    end
--[[    if controlMode == "Advanced" then
        if currentPage == "Tracks" then
            table.insert(graphics, Background(490, 180))
            table.insert(graphics, Background2(25, 90, 440, 80))
            layout["trackSelect"] = Box("Tracks~Select", "Select", 35, 100, 60, 30)
            layout["trackSelectTrigger"] = Button("Tracks~Select trigger", "Select", 35, 130, 60, 30)
            layout["trackErase"] = Button("Tracks~Erase", "Erase", 95, 100)
            layout["trackRecord"] = Button("Tracks~Record", "Record", 155, 100)
            layout["trackStop"] = Button("Tracks~Stop", "Stop", 215, 100)
            layout["trackSnapshotDmx"] = Button("Tracks~Snapshot DMX", "Snapshot\nDMX", 275, 100)
            layout["trackSnapshotArtnet"] = Button("Tracks~Snapshot ArtNet", "Snapshot\nArtnet", 335, 100)
            layout["trackSnapshotSacn"] = Button("Tracks~Snapshot sACN", "Snapshot\nsACN", 395, 100)
        end
        if currentPage == "Timecode" then
            table.insert(graphics, Background(490, 180))
            table.insert(graphics, Background2(55, 90, 380, 80))
            layout["timecodeStart"] = Button("Timecode~Start", "Start", 65, 100)
            layout["timecodeStop"] = Button("Timecode~Stop", "Stop", 125, 100)
            layout["timecodeRestart"] = Button("Timecode~Restart", "Restart", 185, 100)
            layout["timecodePause"] = Button("Timecode~Pause", "Pause", 245, 100)
            layout["timecodeSet"] = Box("Timecode~Set", "Set", 305, 100, 120, 30)
            layout["timecodeSetTrigger"] = Button("Timecode~Set trigger", "Set timecode", 305, 130, 120, 30)
        end
        if currentPage == "Actionlist" then
            table.insert(graphics, Background(490, 650))
            table.insert(graphics, Background2(115, 90, 260, 270))
            for i = 1, 4 do
                layout["actionlistEnable " .. i] =
                    Button("Showcontrol~Actionlist~Enable " .. i, "Enable", 125 + (60 * (i - 1)), 100)
                layout["actionlistDisable " .. i] =
                    Button("Showcontrol~Actionlist~Disable " .. i, "Disable", 125 + (60 * (i - 1)), 160)
                layout["actionlistAction " .. i] =
                    Box("Showcontrol~Actionlist~ " .. i .. " Action", "Action", 125 + (60 * (i - 1)), 250, 60, 30)
                layout["actionlistActionTrigger " .. i] =
                    Box(
                    "Showcontrol~Actionlist~ " .. i .. " Action trigger",
                    "Action",
                    125 + (60 * (i - 1)),
                    280,
                    60,
                    30
                )
                table.insert(graphics, Text(tostring(i), 24, 125 + (60 * (i - 1)), 320, 60, 30))
            end
            table.insert(graphics, Background2(115, 370, 260, 270))
            for i = 5, 8 do
                layout["actionlistEnable " .. i] =
                    Button("Showcontrol~Actionlist~Enable " .. i, "Enable", 125 + (60 * (i - 5)), 380)
                layout["actionlistDisable " .. i] =
                    Button("Showcontrol~Actionlist~Disable " .. i, "Disable", 125 + (60 * (i - 5)), 440)
                layout["actionlistAction " .. i] =
                    Box("Showcontrol~Actionlist~ " .. i .. " Action", "Action", 125 + (60 * (i - 5)), 530, 60, 30)
                layout["actionlistActionTrigger " .. i] =
                    Box(
                    "Showcontrol~Actionlist~ " .. i .. " Action trigger",
                    "Action",
                    125 + (60 * (i - 5)),
                    560,
                    60,
                    30
                )
                table.insert(graphics, Text(tostring(i), 24, 125 + (60 * (i - 5)), 600, 60, 30))
            end
        end
        if currentPage == "Variable" then
            table.insert(graphics, Background(490, 620))
            table.insert(graphics, Background2(85, 90, 320, 210))
            for i = 1, 5 do
                layout["variableSet " .. i] =
                    Box("Showcontrol~Variable~Set " .. i, "Set", 95 + (60 * (i - 1)), 100, 60, 30)
                layout["variableSetTrigger " .. i] =
                    Button("Showcontrol~Variable~Set trigger " .. i, "Set", 95 + (60 * (i - 1)), 130, 60, 30)
                layout["variableRefresh " .. i] =
                    Button("Showcontrol~Variable~Refresh " .. i, "Refresh", 95 + (60 * (i - 1)), 190)
                table.insert(graphics, Text(tostring(i), 24, 95 + (60 * (i - 1)), 260, 60, 30))
            end
            table.insert(graphics, Background2(85, 310, 320, 210))
            for i = 6, 10 do
                layout["variableSet " .. i] =
                    Box("Showcontrol~Variable~Set " .. i, "Set", 95 + (60 * (i - 6)), 320, 60, 30)
                layout["variableSetTrigger " .. i] =
                    Button("Showcontrol~Variable~Set trigger " .. i, "Set", 95 + (60 * (i - 6)), 350, 60, 30)
                layout["variableRefresh " .. i] =
                    Button("Showcontrol~Variable~Refresh " .. i, "Refresh", 95 + (60 * (i - 6)), 410)
                table.insert(graphics, Text(tostring(i), 24, 95 + (60 * (i - 6)), 480, 60, 30))
            end
            table.insert(graphics, Background2(205, 530, 80, 80))
            layout["variableRefreshAll"] = Button("Showcontrol~Variable~Refresh All", "Refresh\nAll", 215, 540)
        end
        if currentPage == "DMX control" then
            table.insert(graphics, Background(490, 360))
            table.insert(graphics, Background2(205, 90, 80, 260))
            table.insert(graphics, Text("Channel", 14, 215, 100, 60, 30))
            layout["dmxChannel"] = Box("Showcontrol~Direct DMX control~Set DMX Channel", "Channel", 215, 140, 60, 30)
            layout["dmxValue"] = Fader("Showcontrol~Direct DMX control~Set DMX Value", "Value", 215, 180)
            layout["dmxTrigger"] = Button("Showcontrol~Direct DMX control~Execute", "Execute", 215, 310, 60, 30)
        end
        if currentPage == "Timer" then
            table.insert(graphics, Background(490, 460))
            table.insert(graphics, Background2(115, 90, 260, 360))
            for i = 1, 4 do
                layout["timerStart " .. i] = Button("Showcontrol~Timer~Start " .. i, "Start", 125 + (60 * (i - 1)), 100)
                layout["timerStop " .. i] = Button("Showcontrol~Timer~Stop " .. i, "Stop", 125 + (60 * (i - 1)), 160)
                layout["timerPause " .. i] = Button("Showcontrol~Timer~Pause " .. i, "Pause", 125 + (60 * (i - 1)), 220)
                layout["timerRestart " .. i] =
                    Button("Showcontrol~Timer~Restart " .. i, "Restart", 125 + (60 * (i - 1)), 280)
                layout["timerSet " .. i] =
                    Box("Showcontrol~Timer~Set " .. i, "Set " .. i, 125 + (60 * (i - 1)), 340, 60, 30)
                layout["timerSetTrigger " .. i] =
                    Button("Showcontrol~Timer~Set trigger" .. i, "Set", 125 + (60 * (i - 1)), 370, 60, 30)
                table.insert(graphics, Text(tostring(i), 24, 125 + (60 * (i - 1)), 410, 60, 30))
            end
        end
    end]]
    if currentPage == "Network" then
        table.insert(graphics, Background(490, 420))
        layout.ipAddress = Box("Network~IP Address", "DMXCoreIP", 145, 160, 325, 60, 40, "Left")
        layout.port = Box("Network~Communications Port", "DMXCorePort", 145, 220, 325, 60, 40, "Left")
        layout.blink = Button("Network~Blink", "Blink", 145, 340)
        table.insert(graphics, Background2(10, 90, 470, 320))
        table.insert(graphics, Text("IP Address", 24, 20, 160, 120, 60, "Left"))
        table.insert(graphics, Text("OSC Port", 24, 20, 220, 120, 60, "Left"))
        table.insert(graphics, Text("Identify", 24, 20, 340, 120, 60, "Left"))
    end
    --Header
    table.insert(graphics, Background2(10, 10, 470, 70))
    table.insert(
        graphics,
        {
            --Logo
            Type = "Image",
            Image = "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",
            Position = {20, 20},
            Size = {250, 46}
        }
    )
    return layout, graphics
end

if not Controls then
    return
end

local masterDimmer = -1
local fadeDuration = -1
local loopCount = -1

local SendFadeDuration = false

local LogReceived = false
local LogPing = false

local SendUpdates = false
local Connected = false
local blinkTimer = 0
local updateTimer = 0
local lastReceived = 0
local currentPreset = ""
local currentCue = ""
IP = ""
port = 8000
rxPort = 9000

local function lpak(_, ...)
    return string.pack(...)
end

local oLvpk = {pack = lpak, unpack = string.unpack}
local mtab = {0, 3, 2, 1}

-- ++++++++++++++++++++++++++++++++++++++++++++++++++++
-- osc private functions
local endpad = string.char(0, 0, 0, 0)
function oscString(Str)
    local newS = Str .. string.char(0x0)
    local mod = string.len(newS) % 4
    return (newS .. string.sub(endpad, 1, mtab[mod + 1]))
end

function oscType(Str)
    return (oscString("," .. Str))
end

function oscSymbol(Str)
    local s1, _ = string.find(Str, " ")
    return (oscString(string.sub(Str, 1, s1)))
end

function align4(n)
    return (math.floor((n - 1) / 4) + 1) * 4
end

function padBin(binD)
    local nwD = binD
    for i = 1, align4(#binD) - #binD do
        nwD = nwD .. string.char(0)
    end
    return nwD
end
-- +++++++++++++++++++++++++++++++++++++++++++++++++++
-- Creates an OSC packet
-- currently accepts the following types:
-- s  string
-- S  alt string
-- c  a char (32 bit int)
-- i  int (32-bit)
-- m  MIDI data, four bytes: channel, status, d1, d2
-- t  TIME data, two 32 ints: seconds, fraction of seconds
-- f  float (32-bit)
-- b  BLOB data, binary bytes
-- h  signed int (64-bit)
-- d  double float (64-bit)
--        The following have NO data block (but are DEcoded to a string: 'NIL', 'TRUE', etc...
-- N  NIL
-- T  TRUE
-- F  FALSE
-- I  Infinitum
-- [  Array begin
-- ]  Array end
function oscPacket(addrS, typeS, msgTab)
    local strl, types  -- , tBlb

    if typeS == nil then
        strl = oscString(addrS) .. oscType("") -- no type & no data...EMPTY type block included in msg (comma and three zeros)
    else
        strl = oscString(addrS) .. oscType(typeS)

        if msgTab ~= nil then -- add data if type has arguments...some do not
            for argC = 1, #msgTab do
                types = string.sub(typeS, argC, argC)
                if types == "s" or types == "S" then
                    strl = strl .. oscString(msgTab[argC])
                elseif types == "f" then
                    strl = strl .. oLvpk.pack("string", ">f", msgTab[argC])
                elseif types == "i" then
                    strl = strl .. oLvpk.pack("string", ">i4", msgTab[argC])
                elseif types == "b" then
                    local tBlb = padBin(msgTab[argC])
                    strl = strl .. oLvpk.pack("string", ">i4", #msgTab[argC]) .. tBlb
                elseif types == "h" then
                    strl = strl .. oLvpk.pack("string", ">i8", msgTab[argC])
                elseif types == "d" then
                    strl = strl .. oLvpk.pack("string", ">d", msgTab[argC])
                elseif types == "c" then
                    strl = strl .. oLvpk.pack("string", ">I", tostring(utf8.codepoint(msgTab[argC])))
                elseif types == "m" then
                    strl = strl .. oLvpk.pack("string", "c4", msgTab[argC])
                elseif types == "t" then
                    strl = strl .. oLvpk.pack("string", "c8", msgTab[argC])
                elseif
                    types == "N" or types == "T" or types == "F" or types == "I" or types == string.char(91) or
                        types == string.char(93)
                 then
                    -- no data
                else
                    return (nil) -- unknown type
                end
            end
        end
    end
    return (strl)
end
-- unpack UDP OSC msg packet into:
--	oscAddr = oA
--	oscType = oT
--	oscData = oD
function oscUnpack(udpM)
    local oA, oT, oD

    oA = udpM:match("^[%p%w]+%z+")
    oT = udpM:match(",[%a%[+%]+]+")
    if oA ~= nil then
        local aBlk = #oA
        oA = oA:gsub("%z", "")
        if oT ~= nil then
            local dataBlk = aBlk + (math.floor((#oT) / 4) + 1) * 4
            oD = string.sub(udpM, dataBlk + 1)
            oT = oT:match("[^,]+")
        end
    end
    return oA, oT, oD
end
-- unpack OSC data block
-- currently unpacks the following types:
-- s  string
-- S  alt string
-- c  a char (but 32 bit int)
-- i  int (32-bit)
-- m  MIDI data, four bytes: channel, status, d1, d2
-- t  TIME data, two 32 ints: seconds, fraction of seconds
-- f  float (32-bit)
-- b  BLOB data, binary bytes
-- h  signed int (64-bit)
-- d  double float (64-bit)
--        These have no data block; a string ID is inserted in unpack table:
-- N  'NIL'
-- T  'TRUE'
-- F  'FALSE'
-- I  'INFINITUM'
-- [  'ARRAY_BEGIN'
-- ]  'ARRAY_END'
function oscDataUnpack(oT, oD)
    local tc, iv, nx, zloc
    local dTbl = {}
    if oT ~= nil then
        for i = 1, #oT do
            tc = oT:sub(i, i)
            if tc == "f" then
                iv, nx = oLvpk.unpack(">f", oD)
                oD = string.sub(oD, 5)
                table.insert(dTbl, tonumber(iv))
            elseif tc == "s" or tc == "S" then
                zloc, nx = string.find(oD, "\0")
                local tmpS = string.sub(oD, 1, zloc - 1)
                iv = string.format("%s", tmpS)
                nx = zloc + mtab[zloc % 4 + 1]
                oD = string.sub(oD, nx + 1)
                table.insert(dTbl, tostring(iv))
            elseif tc == "b" then
                iv, nx = oLvpk.unpack(">i", oD)
                local blb = string.sub(oD, 1, iv + nx)
                oD = string.sub(oD, align4(iv - 1) + nx)
                table.insert(dTbl, blb)
            elseif tc == "i" or tc == "r" then
                iv, nx = oLvpk.unpack(">i", oD)
                oD = string.sub(oD, 5)
                table.insert(dTbl, tonumber(iv))
            elseif tc == "c" then
                iv, nx = oLvpk.unpack(">i", oD)
                oD = string.sub(oD, 5)
                table.insert(dTbl, utf8.char(iv))
            elseif tc == "m" then
                iv, nx = oLvpk.unpack("c4", oD)
                oD = string.sub(oD, 5)
                table.insert(dTbl, iv)
            elseif tc == "t" then
                iv, nx = oLvpk.unpack("c8", oD)
                oD = string.sub(oD, 9)
                table.insert(dTbl, iv)
            elseif tc == "h" then
                iv, nx = oLvpk.unpack(">i8", oD)
                oD = string.sub(oD, 9)
                table.insert(dTbl, tonumber(iv))
            elseif tc == "d" then
                iv, nx = oLvpk.unpack(">d", oD)
                oD = string.sub(oD, 9)
                table.insert(dTbl, tonumber(iv))
            elseif tc == "I" then
                table.insert(dTbl, "IMPULSE")
            elseif tc == "T" then
                table.insert(dTbl, "TRUE")
            elseif tc == "F" then
                table.insert(dTbl, "FALSE")
            elseif tc == "N" then
                table.insert(dTbl, "NIL")
            elseif tc == string.char(91) then
                table.insert(dTbl, "ARRAY_BEGIN")
            elseif tc == string.char(93) then
                table.insert(dTbl, "ARRAY_END")
            end
        end
    end
    return dTbl
end

function SetActive(ledControl, codeControl, currentValue)
    local ledValue

    if currentValue == codeControl.String and codeControl.String ~= "" then
        ledValue = 1
    else
        ledValue = 0
    end

    ledControl.Position = ledValue
end

function HandleData(socket, packet)
    local oscADDR, oscTYPE, oscDATA = oscUnpack(packet.Data)
    local dataT = oscDataUnpack(oscTYPE, oscDATA)

    lastReceived = updateTimer

    if dataT[1] ~= nil then
        if oscADDR == "/dmxcore/dimmer/master" then
            print("Master dimmer = " .. dataT[1])
            Controls.MasterDimmer.Position = dataT[1]
        elseif oscADDR == "/dmxcore/status/preset" then
            print("Preset = " .. dataT[1])
            currentPreset = dataT[1]
            if currentPreset ~= "" then
                currentCue = ""
            end
        elseif oscADDR == "/dmxcore/status/cue" then
            print("Cue = " .. dataT[1])
            currentCue = dataT[1]
            if currentCue ~= "" then
                currentPreset = ""
            end
        elseif oscADDR == "/dmxcore/status/text" then
            print("Status = " .. dataT[1])
            Controls.StatusDisplay.String = dataT[1]
        end
    end

    SetActive(Controls.PresetActive[1], Controls.PresetCode[1], currentPreset)
    SetActive(Controls.PresetActive[2], Controls.PresetCode[2], currentPreset)
    SetActive(Controls.PresetActive[3], Controls.PresetCode[3], currentPreset)
    SetActive(Controls.PresetActive[4], Controls.PresetCode[4], currentPreset)
    SetActive(Controls.PresetActive[5], Controls.PresetCode[5], currentPreset)
    SetActive(Controls.PresetActive[6], Controls.PresetCode[6], currentPreset)

    SetActive(Controls.CueActive[1], Controls.CueCode[1], currentCue)
    SetActive(Controls.CueActive[2], Controls.CueCode[2], currentCue)
    SetActive(Controls.CueActive[3], Controls.CueCode[3], currentCue)
    SetActive(Controls.CueActive[4], Controls.CueCode[4], currentCue)
    SetActive(Controls.CueActive[5], Controls.CueCode[5], currentCue)
    SetActive(Controls.CueActive[6], Controls.CueCode[6], currentCue)

    if LogReceived then
        -- output to console
        print(oscADDR, oscTYPE)
        if dataT ~= nil then
            for i, v in ipairs(dataT) do
                print(i .. ")", v)
            end
        end
    end
end

local tokenize = function(input, sep)
    local t = {}
    for str in string.gmatch(input, "([^" .. sep .. "]+)") do
        table.insert(t, str)
    end
    return t
end

local getIpAddress = function()
    local ipAddress = Controls.DMXCoreIP.String
    print("IP address is set to: ", ipAddress)
    if ipAddress == "" then
        print("IP address can not be empty, setting to default: ", defaultIpAddress)
        ipAddress = defaultIpAddress
        Controls.DMXCoreIP.String = defaultIpAddress
    end
    local ipTable = tokenize(ipAddress, ".")
    if #ipTable ~= 4 then
        ipAddress = "INVALID"
    else
        for _, v in ipairs(ipTable) do
            if tonumber(v) == nil or tonumber(v) < 0 or tonumber(v) > 255 then
                ipAddress = "INVALID"
                break
            end
        end
    end
    if ipAddress == "INVALID" then
        print("Invalid IP address, setting to default: ", defaultIpAddress)
        ipAddress = defaultIpAddress
        Controls.DMXCoreIP.String = defaultIpAddress
    end
    return ipAddress
end

local getPort = function()
    local port = Controls.DMXCorePort.String
    print("Port is set to: ", port)
    if string.match(port, "%D") then
        print("Invalid port, setting to default: ", defaultPort)
        port = defaultPort
        Controls.DMXCorePort.String = defaultPort
    end
    port = tonumber(port)
    if port == nil then
        print("Port can not be empty, setting to default: ", defaultPort)
        port = defaultPort
        Controls.DMXCorePort.String = defaultPort
    end
    return port
end

Controls.StatusDisplay.String = ""
fadeDuration = Controls.FadeDuration.Value
loopCount = Controls.LoopCount.Value
Controls.FadeDurationDisplay.String = string.format("%.1f", fadeDuration) .. " s"
if loopCount == 0 then
    Controls.LoopCountDisplay.String = "Infinite"
else
    Controls.LoopCountDisplay.String = string.format("%.0f", loopCount)
end

OscSocket = UdpSocket.New()

-- Open socket
OscSocket:Open(nil, rxPort)

-- When data is received, handle it. Here I'm translating using the helper function above, then if the address matches a particular one, sending the values into a function built to handle that.
OscSocket.Data = HandleData

IP = getIpAddress()
port = getPort()

function timer1_func()
    blinkTimer = blinkTimer + 1

    Controls.ScriptActive.Position = blinkTimer % 2

    if blinkTimer == 5 then
        -- 5 seconds
        if LogPing then
            print("Sending Ping Message")
        end
        OscSocket:Send(IP, port, oscPacket("/ping", nil, {}))
        blinkTimer = 0
    end
end

OscSocket:Send(IP, port, oscPacket("/dmxcore/status", nil, {}))

-- Add the timer
Timer1 = Timer.New()
Timer1.EventHandler = timer1_func

-- and start it with a delay of 1000 ms
Timer1:Start(1)

-- Wire up event handlers
Controls.DMXCoreIP.EventHandler = function()
    ipAddress = getIpAddress()
end
Controls.DMXCorePort.EventHandler = function()
    port = getPort()
end
Controls.Blink.EventHandler = function(control)
    OscSocket:Send(IP, port, oscPacket("/dmxcore/blink", "i", {control.Value}))
end
Controls.MasterDimmer.EventHandler = function(control)
    OscSocket:Send(IP, port, oscPacket("/dmxcore/dimmer/master", "f", {control.Position}))
end
Controls.GoToPreset[1].EventHandler = function()
    OscSocket:Send(
        IP,
        port,
        oscPacket("/dmxcore/preset/" .. Controls.PresetCode[1].String, "i", {math.floor(fadeDuration * 1000)})
    )
end
Controls.GoToPreset[2].EventHandler = function()
    OscSocket:Send(
        IP,
        port,
        oscPacket("/dmxcore/preset/" .. Controls.PresetCode[2].String, "i", {math.floor(fadeDuration * 1000)})
    )
end
Controls.GoToPreset[3].EventHandler = function()
    OscSocket:Send(
        IP,
        port,
        oscPacket("/dmxcore/preset/" .. Controls.PresetCode[3].String, "i", {math.floor(fadeDuration * 1000)})
    )
end
Controls.GoToPreset[4].EventHandler = function()
    OscSocket:Send(
        IP,
        port,
        oscPacket("/dmxcore/preset/" .. Controls.PresetCode[4].String, "i", {math.floor(fadeDuration * 1000)})
    )
end
Controls.GoToPreset[5].EventHandler = function()
    OscSocket:Send(
        IP,
        port,
        oscPacket("/dmxcore/preset/" .. Controls.PresetCode[5].String, "i", {math.floor(fadeDuration * 1000)})
    )
end
Controls.GoToPreset[6].EventHandler = function()
    OscSocket:Send(
        IP,
        port,
        oscPacket("/dmxcore/preset/" .. Controls.PresetCode[6].String, "i", {math.floor(fadeDuration * 1000)})
    )
end

Controls.PlayCue[1].EventHandler = function()
    OscSocket:Send(IP, port, oscPacket("/dmxcore/cue/" .. Controls.CueCode[1].String, "i", {loopCount}))
end
Controls.PlayCue[2].EventHandler = function()
    OscSocket:Send(IP, port, oscPacket("/dmxcore/cue/" .. Controls.CueCode[2].String, "i", {loopCount}))
end
Controls.PlayCue[3].EventHandler = function()
    OscSocket:Send(IP, port, oscPacket("/dmxcore/cue/" .. Controls.CueCode[3].String, "i", {loopCount}))
end
Controls.PlayCue[4].EventHandler = function()
    OscSocket:Send(IP, port, oscPacket("/dmxcore/cue/" .. Controls.CueCode[4].String, "i", {loopCount}))
end
Controls.PlayCue[5].EventHandler = function()
    OscSocket:Send(IP, port, oscPacket("/dmxcore/cue/" .. Controls.CueCode[5].String, "i", {loopCount}))
end
Controls.PlayCue[6].EventHandler = function()
    OscSocket:Send(IP, port, oscPacket("/dmxcore/cue/" .. Controls.CueCode[6].String, "i", {loopCount}))
end

Controls.StopCue.EventHandler = function()
    OscSocket:Send(IP, port, oscPacket("/dmxcore/cuecontrol/stop", nil, {}))
end

Controls.FadeDuration.EventHandler = function(control)
    fadeDuration = control.Value
    Controls.FadeDurationDisplay.String = string.format("%.1f", fadeDuration) .. " s"
end

Controls.LoopCount.EventHandler = function(control)
    loopCount = control.Value
    if loopCount == 0 then
        Controls.LoopCountDisplay.String = "Infinite"
    else
        Controls.LoopCountDisplay.String = string.format("%.0f", loopCount)
    end
end

Controls.FadeToBlack.EventHandler = function()
    OscSocket:Send(IP, port, oscPacket("/dmxcore/dimmer/master/fadeto", "fi", {0, math.floor(fadeDuration * 1000)}))
end
Controls.FadeTo100.EventHandler = function()
    OscSocket:Send(IP, port, oscPacket("/dmxcore/dimmer/master/fadeto", "fi", {1, math.floor(fadeDuration * 1000)}))
end
